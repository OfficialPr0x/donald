
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intimate AI</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .chat-container {
            height: calc(100vh - 180px);
        }
        .chat-messages {
            height: calc(100% - 60px);
            overflow-y: auto;
        }
        .message {
            max-width: 80%;
            margin-bottom: 10px;
            padding: 10px 15px;
            border-radius: 18px;
        }
        .user-message {
            background-color: #e2f5fe;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        .bot-message {
            background-color: #f0f0f0;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 5px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- App Content -->
    </div>

    <script>
        // Main application
        const app = {
            state: {
                currentView: 'landing',
                user: null,
                deviceConnected: false,
                deviceKey: '',
                deviceStatus: 'disconnected',
                preferences: {
                    ageGroup: '',
                    sex: '',
                    demeanor: ''
                },
                selectedVoice: null,
                voices: [
                    { id: 'v1', name: 'Sophia', sample: 'https://example.com/sophia.mp3', description: 'Warm and nurturing' },
                    { id: 'v2', name: 'Emma', sample: 'https://example.com/emma.mp3', description: 'Playful and teasing' },
                    { id: 'v3', name: 'Victoria', sample: 'https://example.com/victoria.mp3', description: 'Dominant and assertive' },
                    { id: 'v4', name: 'Lily', sample: 'https://example.com/lily.mp3', description: 'Shy and submissive' },
                    { id: 'v5', name: 'Zoe', sample: 'https://example.com/zoe.mp3', description: 'Seductive and mysterious' },
                    { id: 'v6', name: 'James', sample: 'https://example.com/james.mp3', description: 'Confident and commanding' },
                    { id: 'v7', name: 'David', sample: 'https://example.com/david.mp3', description: 'Gentle and reassuring' },
                    { id: 'v8', name: 'Alex', sample: 'https://example.com/alex.mp3', description: 'Playful and energetic' },
                    { id: 'v9', name: 'Sam', sample: 'https://example.com/sam.mp3', description: 'Non-binary and supportive' },
                    { id: 'v10', name: 'Max', sample: 'https://example.com/max.mp3', description: 'Intense and passionate' }
                ],
                messages: [],
                isProcessing: false,
                isRecording: false,
                strokeSpeed: 50,
                strokePosition: 50,
                audioPlayer: new Audio()
            },
            
            init() {
                this.render();
                // Check if user is logged in (would use Firebase/Auth in production)
                const savedUser = localStorage.getItem('user');
                if (savedUser) {
                    this.state.user = JSON.parse(savedUser);
                    this.state.currentView = 'deviceConnect';
                    this.render();
                }
            },
            
            // Authentication methods
            register(email, password) {
                // Simulate registration - in production would use Firebase Auth
                if (!email || !password) {
                    alert('Please fill in all fields');
                    return;
                }
                
                // Mock successful registration
                this.state.user = { 
                    email, 
                    id: 'user_' + Math.random().toString(36).substr(2, 9),
                    active: false 
                };
                localStorage.setItem('user', JSON.stringify(this.state.user));
                
                // Move to payment
                this.state.currentView = 'payment';
                this.render();
            },
            
            login(email, password) {
                // Simulate login - in production would use Firebase Auth
                if (!email || !password) {
                    alert('Please fill in all fields');
                    return;
                }
                
                // Mock successful login
                this.state.user = { 
                    email, 
                    id: 'user_' + Math.random().toString(36).substr(2, 9),
                    active: true 
                };
                localStorage.setItem('user', JSON.stringify(this.state.user));
                
                // Move to device connection
                this.state.currentView = 'deviceConnect';
                this.render();
            },
            
            logout() {
                this.state.user = null;
                this.state.deviceConnected = false;
                this.state.messages = [];
                localStorage.removeItem('user');
                this.state.currentView = 'landing';
                this.render();
            },
            
            // Payment processing
            processPayment() {
                // Simulate payment - would use Stripe in production
                console.log('Processing payment...');
                
                // Update user status
                this.state.user.active = true;
                localStorage.setItem('user', JSON.stringify(this.state.user));
                
                // Move to device connection
                this.state.currentView = 'deviceConnect';
                this.render();
            },
            
            // Device connection
            connectDevice() {
                if (!this.state.deviceKey) {
                    alert('Please enter your Handy Connection Key');
                    return;
                }
                
                // Simulate API call to Handy
                console.log('Connecting to Handy with key:', this.state.deviceKey);
                
                // Mock successful connection
                setTimeout(() => {
                    this.state.deviceConnected = true;
                    this.state.deviceStatus = 'connected';
                    
                    // Move to preferences
                    this.state.currentView = 'preferences';
                    this.render();
                }, 1500);
            },
            
            // Save preferences
            savePreferences() {
                const { ageGroup, sex, demeanor } = this.state.preferences;
                
                if (!ageGroup || !sex || !demeanor) {
                    alert('Please select all preferences');
                    return;
                }
                
                // Move to voice selection
                this.state.currentView = 'voiceSelection';
                this.render();
            },
            
            // Voice selection
            selectVoice(voiceId) {
                this.state.selectedVoice = this.state.voices.find(v => v.id === voiceId);
                
                // Play sample
                this.state.audioPlayer.src = this.state.selectedVoice.sample;
                this.state.audioPlayer.play();
            },
            
            confirmVoice() {
                if (!this.state.selectedVoice) {
                    alert('Please select a voice');
                    return;
                }
                
                // Move to main chat interface
                this.state.currentView = 'chat';
                this.render();
                
                // Add welcome message
                setTimeout(() => {
                    this.receiveMessage("Hello! I'm excited to connect with you. How would you like to begin?");
                }, 1000);
            },
            
            // Chat functionality
            sendMessage(text) {
                if (!text.trim() || this.state.isProcessing) return;
                
                // Add user message
                this.state.messages.push({
                    sender: 'user',
                    text: text,
                    timestamp: new Date()
                });
                
                // Clear input and render
                document.getElementById('messageInput').value = '';
                this.render();
                
                // Scroll to bottom
                this.scrollToBottom();
                
                // Process message
                this.processMessage(text);
            },
            
            processMessage(text) {
                this.state.isProcessing = true;
                
                // Simulate typing indicator
                this.render();
                
                // Simulate AI response delay (would use Venice.ai in production)
                setTimeout(() => {
                    // Parse for intents - simplified version
                    let response, action;
                    
                    if (text.toLowerCase().includes('edge') || text.toLowerCase().includes('tease')) {
                        response = "I'll edge you slowly... building up the pleasure. Let me control your rhythm.";
                        action = 'edge';
                    } else if (text.toLowerCase().includes('faster') || text.toLowerCase().includes('speed up')) {
                        response = "Going faster now, feeling the intensity build...";
                        action = 'speed';
                    } else if (text.toLowerCase().includes('slower') || text.toLowerCase().includes('gentle')) {
                        response = "Slowing down, taking it nice and easy...";
                        action = 'slow';
                    } else if (text.toLowerCase().includes('stop')) {
                        response = "Stopping now. Let me know when you want to continue.";
                        action = 'stop';
                    } else if (text.toLowerCase().includes('pause')) {
                        response = "Pausing for a moment. Ready when you are.";
                        action = 'pause';
                    } else {
                        response = "I'm here with you, enjoying our connection. Tell me what you desire.";
                        action = 'default';
                    }
                    
                    // Receive message and perform device action
                    this.receiveMessage(response);
                    this.performDeviceAction(action);
                    
                    this.state.isProcessing = false;
                    this.render();
                }, 1500);
            },
            
            receiveMessage(text) {
                // Add bot message
                this.state.messages.push({
                    sender: 'bot',
                    text: text,
                    timestamp: new Date()
                });
                
                this.render();
                
                // Scroll to bottom
                this.scrollToBottom();
                
                // Simulate voice playback (would use Venice.ai TTS in production)
                console.log('Playing voice response:', text);
            },
            
            performDeviceAction(action) {
                // Simulate Handy API calls
                console.log('Performing device action:', action);
                
                switch(action) {
                    case 'edge':
                        // Simulate edging pattern
                        this.setStrokeSpeed(30);
                        setTimeout(() => this.setStrokeSpeed(70), 3000);
                        setTimeout(() => this.setStrokeSpeed(0), 5000);
                        setTimeout(() => this.setStrokeSpeed(50), 7000);
                        break;
                    case 'speed':
                        this.setStrokeSpeed(Math.min(this.state.strokeSpeed + 20, 100));
                        break;
                    case 'slow':
                        this.setStrokeSpeed(Math.max(this.state.strokeSpeed - 20, 10));
                        break;
                    case 'stop':
                        this.setStrokeSpeed(0);
                        break;
                    case 'pause':
                        this.setStrokeSpeed(0);
                        break;
                    default:
                        // Default pattern
                        this.setStrokeSpeed(50);
                }
            },
            
            setStrokeSpeed(speed) {
                this.state.strokeSpeed = speed;
                console.log(`Setting stroke speed to ${speed}%`);
                this.render();
            },
            
            setStrokePosition(position) {
                this.state.strokePosition = position;
                console.log(`Setting stroke position to ${position}%`);
                // Would send to Handy API in production
            },
            
            pauseDevice() {
                this.setStrokeSpeed(0);
                console.log('Device paused');
            },
            
            stopDevice() {
                this.setStrokeSpeed(0);
                console.log('Device stopped');
            },
            
            startVoiceInput() {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    alert('Voice input is not supported in your browser');
                    return;
                }
                
                this.state.isRecording = true;
                this.render();
                
                // Simulate voice recording (would use actual Web Audio API in production)
                setTimeout(() => {
                    this.state.isRecording = false;
                    this.render();
                    this.sendMessage("This is a simulated voice message");
                }, 3000);
            },
            
            scrollToBottom() {
                setTimeout(() => {
                    const chatContainer = document.querySelector('.chat-messages');
                    if (chatContainer) {
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }
                }, 100);
            },
            
            render() {
                const appContainer = document.getElementById('app');
                
                // Render different views based on current state
                switch(this.state.currentView) {
                    case 'landing':
                        appContainer.innerHTML = this.renderLandingPage();
                        break;
                    case 'login':
                        appContainer.innerHTML = this.renderLoginPage();
                        break;
                    case 'register':
                        appContainer.innerHTML = this.renderRegisterPage();
                        break;
                    case 'payment':
                        appContainer.innerHTML = this.renderPaymentPage();
                        break;
                    case 'deviceConnect':
                        appContainer.innerHTML = this.renderDeviceConnectPage();
                        break;
                    case 'preferences':
                        appContainer.innerHTML = this.renderPreferencesPage();
                        break;
                    case 'voiceSelection':
                        appContainer.innerHTML = this.renderVoiceSelectionPage();
                        break;
                    case 'chat':
                        appContainer.innerHTML = this.renderChatPage();
                        break;
                    default:
                        appContainer.innerHTML = this.renderLandingPage();
                }
                
                // Add event listeners after rendering
                this.addEventListeners();
            },
            
            // Event listeners for the current view
            addEventListeners() {
                switch(this.state.currentView) {
                    case 'login':
                        document.getElementById('loginForm')?.addEventListener('submit', (e) => {
                            e.preventDefault();
                            const email = document.getElementById('email').value;
                            const password = document.getElementById('password').value;
                            this.login(email, password);
                        });
                        break;
                    case 'register':
                        document.getElementById('registerForm')?.addEventListener('submit', (e) => {
                            e.preventDefault();
                            const email = document.getElementById('email').value;
                            const password = document.getElementById('password').value;
                            const confirm = document.getElementById('confirmPassword').value;
                            const ageConfirm = document.getElementById('ageConfirm').checked;
                            
                            if (password !== confirm) {
                                alert('Passwords do not match');
                                return;
                            }
                            
                            if (!ageConfirm) {
                                alert('You must confirm you are 18+ to continue');
                                return;
                            }
                            
                            this.register(email, password);
                        });
                        break;
                    case 'payment':
                        document.getElementById('paymentForm')?.addEventListener('submit', (e) => {
                            e.preventDefault();
                            this.processPayment();
                        });
                        break;
                    case 'deviceConnect':
                        document.getElementById('deviceForm')?.addEventListener('submit', (e) => {
                            e.preventDefault();
                            this.connectDevice();
                        });
                        document.getElementById('deviceKey')?.addEventListener('input', (e) => {
                            this.state.deviceKey = e.target.value;
                        });
                        break;
                    case 'preferences':
                        document.querySelectorAll('input[name="ageGroup"]').forEach(input => {
                            input.addEventListener('change', (e) => {
                                this.state.preferences.ageGroup = e.target.value;
                            });
                        });
                        document.querySelectorAll('input[name="sex"]').forEach(input => {
                            input.addEventListener('change', (e) => {
                                this.state.preferences.sex = e.target.value;
                            });
                        });
                        document.querySelectorAll('input[name="demeanor"]').forEach(input => {
                            input.addEventListener('change', (e) => {
                                this.state.preferences.demeanor = e.target.value;
                            });
                        });
                        document.getElementById('preferencesForm')?.addEventListener('submit', (e) => {
                            e.preventDefault();
                            this.savePreferences();
                        });
                        break;
                    case 'voiceSelection':
                        document.querySelectorAll('.voice-option').forEach(option => {
                            option.addEventListener('click', (e) => {
                                const voiceId = e.currentTarget.dataset.voiceId;
                                this.selectVoice(voiceId);
                                
                                // Update selected state in UI
                                document.querySelectorAll('.voice-option').forEach(opt => {
                                    opt.classList.remove('ring-2', 'ring-blue-500');
                                });
                                e.currentTarget.classList.add('ring-2', 'ring-blue-500');
                            });
                        });
                        document.getElementById('confirmVoiceBtn')?.addEventListener('click', () => {
                            this.confirmVoice();
                        });
                        break;
                    case 'chat':
                        document.getElementById('messageForm')?.addEventListener('submit', (e) => {
                            e.preventDefault();
                            const messageInput = document.getElementById('messageInput');
                            this.sendMessage(messageInput.value);
                        });
                        document.getElementById('voiceInputBtn')?.addEventListener('click', () => {
                            this.startVoiceInput();
                        });
                        document.getElementById('pauseBtn')?.addEventListener('click', () => {
                            this.pauseDevice();
                        });
                        document.getElementById('stopBtn')?.addEventListener('click', () => {
                            this.stopDevice();
                        });
                        document.getElementById('speedSlider')?.addEventListener('input', (e) => {
                            this.setStrokeSpeed(parseInt(e.target.value));
                        });
                        document.getElementById('positionSlider')?.addEventListener('input', (e) => {
                            this.setStrokePosition(parseInt(e.target.value));
                        });
                        break;
                }
                
                // Global logout button
                document.getElementById('logoutBtn')?.addEventListener('click', () => {
                    this.logout();
                });
            },
            
            // View renderers
            renderLandingPage() {
                return `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-blue-500 to-purple-600 text-white p-4">
                    <div class="max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-gray-800">
                        <h1 class="text-3xl font-bold text-center mb-2">Intimate AI</h1>
                        <p class="text-center text-gray-600 mb-8">Connect with your Handy device for an AI-driven experience</p>
                        
                        <div class="space-y-4">
                            <button onclick="app.state.currentView = 'login'; app.render()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                Login
                            </button>
                            <button onclick="app.state.currentView = 'register'; app.render()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                Register
                            </button>
                        </div>
                        
                        <p class="text-xs text-center mt-8 text-gray-500">
                            By using this app, you confirm you are 18+ years of age and agree to our Terms of Service
                        </p>
                    </div>
                </div>
                `;
            },
            
            renderLoginPage() {
                return `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
                    <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8">
                        <h1 class="text-2xl font-bold text-center mb-6">Login</h1>
                        
                        <form id="loginForm" class="space-y-4">
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                <input type="password" id="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200">
                                Login
                            </button>
                        </form>
                        
                        <div class="mt-6 text-center">
                            <p class="text-sm text-gray-600">
                                Don't have an account? 
                                <a href="#" onclick="app.state.currentView = 'register'; app.render(); return false;" class="text-blue-600 hover:underline">Register</a>
                            </p>
                        </div>
                    </div>
                </div>
                `;
            },
            
            renderRegisterPage() {
                return `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
                    <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8">
                        <h1 class="text-2xl font-bold text-center mb-6">Create Account</h1>
                        
                        <form id="registerForm" class="space-y-4">
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                <input type="password" id="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                                <input type="password" id="confirmPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div class="flex items-start">
                                <input type="checkbox" id="ageConfirm" required class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="ageConfirm" class="ml-2 block text-sm text-gray-700">
                                    I confirm I am at least 18 years old
                                </label>
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200">
                                Register
                            </button>
                        </form>
                        
                        <div class="mt-6 text-center">
                            <p class="text-sm text-gray-600">
                                Already have an account? 
                                <a href="#" onclick="app.state.currentView = 'login'; app.render(); return false;" class="text-blue-600 hover:underline">Login</a>
                            </p>
                        </div>
                    </div>
                </div>
                `;
            },
            
            renderPaymentPage() {
                return `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
                    <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8">
                        <h1 class="text-2xl font-bold text-center mb-2">Complete Your Subscription</h1>
                        <p class="text-center text-gray-600 mb-6">Unlock full access to Intimate AI</p>
                        
                        <div class="bg-gray-50 p-4 rounded-lg mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Monthly Subscription</span>
                                <span class="font-bold">$9.99/month</span>
                            </div>
                            <p class="text-sm text-gray-600">Unlimited chat sessions with AI companions</p>
                        </div>
                        
                        <form id="paymentForm" class="space-y-4">
                            <div>
                                <label for="cardNumber" class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="expiry" class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                                    <input type="text" id="expiry" placeholder="MM/YY" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label for="cvc" class="block text-sm font-medium text-gray-700 mb-1">CVC</label>
                                    <input type="text" id="cvc" placeholder="123" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200">
                                Subscribe Now
                            </button>
                        </form>
                        
                        <p class="text-xs text-center mt-6 text-gray-500">
                            Your payment is secure and processed via Stripe. You can cancel anytime.
                        </p>
                    </div>
                </div>
                `;
            },
            
            renderDeviceConnectPage() {
                return `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
                    <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8">
                        <h1 class="text-2xl font-bold text-center mb-2">Connect Your Device</h1>
                        <p class="text-center text-gray-600 mb-6">Enter your Handy Connection Key to connect</p>
                        
                        <form id="deviceForm" class="space-y-6">
                            <div>
                                <label for="deviceKey" class="block text-sm font-medium text-gray-700 mb-1">Connection Key</label>
                                <input type="text" id="deviceKey" required placeholder="Enter your Handy connection key" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="mt-1 text-xs text-gray-500">Find this in your Handy app settings</p>
                            </div>
                            
                            <div class="flex items-center justify-center">
                                <div class="flex flex-col items-center">
                                    <div class="h-4 w-4 rounded-full ${this.state.deviceConnected ? 'bg-green-500' : 'bg-gray-300'} ${!this.state.deviceConnected && this.state.deviceKey ? 'pulse' : ''}"></div>
                                    <span class="mt-1 text-xs text-gray-600">${this.state.deviceStatus}</span>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200">
                                Connect Device
                            </button>
                        </form>
                        
                        <div class="mt-6">
                            <p class="text-sm text-gray-600 text-center">
                                Need help? <a href="#" class="text-blue-600 hover:underline">View connection guide</a>
                            </p>
                        </div>
                        
                        <div class="mt-8 pt-4 border-t border-gray-200">
                            <button id="logoutBtn" class="text-sm text-red-600 hover:text-red-800">Logout</button>
                        </div>
                    </div>
                </div>
                `;
            },
            
            renderPreferencesPage() {
                return `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
                    <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8">
                        <h1 class="text-2xl font-bold text-center mb-2">Your Preferences</h1>
                        <p class="text-center text-gray-600 mb-6">Help us personalize your experience</p>
                        
                        <form id="preferencesForm" class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Age Group</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="ageGroup" value="18-25" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">18-25</span>
                                    </label>
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="ageGroup" value="26-35" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">26-35</span>
                                    </label>
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="ageGroup" value="36-45" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">36-45</span>
                                    </label>
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="ageGroup" value="46+" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">46+</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sex</label>
                                <div class="grid grid-cols-3 gap-3">
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="sex" value="male" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">Male</span>
                                    </label>
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="sex" value="female" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">Female</span>
                                    </label>
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="sex" value="non-binary" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">Non-binary</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Demeanor</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="demeanor" value="shy" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">Shy</span>
                                    </label>
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="demeanor" value="dominant" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">Dominant</span>
                                    </label>
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="demeanor" value="submissive" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">Submissive</span>
                                    </label>
                                    <label class="flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="demeanor" value="playful" class="h-4 w-4 text-blue-600">
                                        <span class="ml-2 text-sm">Playful</span>
                                    </label>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200">
                                Continue
                            </button>
                        </form>
                        
                        <div class="mt-8 pt-4 border-t border-gray-200 flex justify-between">
                            <button onclick="app.state.currentView = 'deviceConnect'; app.render()" class="text-sm text-gray-600 hover:text-gray-800">Back</button>
                            <button id="logoutBtn" class="text-sm text-red-600 hover:text-red-800">Logout</button>
                        </div>
                    </div>
                </div>
                `;
            },
            
            renderVoiceSelectionPage() {
                return `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
                    <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8">
                        <h1 class="text-2xl font-bold text-center mb-2">Choose a Voice</h1>
                        <p class="text-center text-gray-600 mb-6">Select a voice persona for your AI companion</p>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            ${this.state.voices.slice(0, 6).map(voice => `
                                <div class="voice-option p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition duration-200 ${this.state.selectedVoice?.id === voice.id ? 'ring-2 ring-blue-500' : ''}" data-voice-id="${voice.id}">
                                    <div class="font-medium">${voice.name}</div>
                                    <div class="text-xs text-gray-600">${voice.description}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="flex justify-center mb-6">
                            <button id="confirmVoiceBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-md transition duration-200 ${!this.state.selectedVoice ? 'opacity-50 cursor-not-allowed' : ''}">
                                Confirm Selection
                            </button>
                        </div>
                        
                        <div class="mt-8 pt-4 border-t border-gray-200 flex justify-between">
                            <button onclick="app.state.currentView = 'preferences'; app.render()" class="text-sm text-gray-600 hover:text-gray-800">Back</button>
                            <button id="logoutBtn" class="text-sm text-red-600 hover:text-red-800">Logout</button>
                        </div>
                    </div>
                </div>
                `;
            },
            
            renderChatPage() {
                return `
                <div class="flex flex-col h-screen bg-gray-100">
                    <!-- Header -->
                    <header class="bg-white shadow-sm px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center">
                            <h1 class="font-bold text-lg">Intimate AI</h1>
                            <div class="ml-3 flex items-center">
                                <div class="h-3 w-3 rounded-full ${this.state.deviceStatus === 'connected' ? 'bg-green-500' : 'bg-red-500'}"></div>
                                <span class="ml-1 text-xs text-gray-600">${this.state.deviceStatus}</span>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <button id="logoutBtn" class="text-sm text-gray-600 hover:text-gray-800">Logout</button>
                        </div>
                    </header>
                    
                    <!-- Main Chat Area -->
                    <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
                        <!-- Chat Messages -->
                        <div class="flex-1 flex flex-col bg-white md:border-r">
                            <div class="chat-container flex flex-col p-4">
                                <div class="chat-messages">
                                    ${this.state.messages.map(message => `
                                        <div class="message ${message.sender === 'user' ? 'user-message' : 'bot-message'} fade-in">
                                            ${message.text}
                                        </div>
                                    `).join('')}
                                    ${this.state.isProcessing ? `
                                        <div class="message bot-message">
                                            <div class="flex space-x-2">
                                                <div class="h-2 w-2 bg-gray-400 rounded-full animate-bounce"></div>
                                                <div class="h-2 w-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                                <div class="h-2 w-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                                
                                <form id="messageForm" class="mt-auto flex items-center">
                                    <input id="messageInput" type="text" placeholder="Type your message..." class="flex-1 px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <button type="button" id="voiceInputBtn" class="px-3 py-2 bg-gray-200 text-gray-700 border-t border-b border-r ${this.state.isRecording ? 'bg-red-100 text-red-600' : ''}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                                        </svg>
                                    </button>
                                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-r-lg hover:bg-blue-700">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                                        </svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Device Controls -->
                        <div class="bg-gray-50 p-4 md:w-72">
                            <h2 class="font-medium text-lg mb-4">Device Controls</h2>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Speed</label>
                                <input id="speedSlider" type="range" min="0" max="100" value="${this.state.strokeSpeed}" class="slider mb-1">
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>Slow</span>
                                    <span>${this.state.strokeSpeed}%</span>
                                    <span>Fast</span>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Position</label>
                                <input id="positionSlider" type="range" min="0" max="100" value="${this.state.strokePosition}" class="slider mb-1">
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>Top</span>
                                    <span>${this.state.strokePosition}%</span>
                                    <span>Bottom</span>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3 mt-8">
                                <button id="pauseBtn" class="flex items-center justify-center py-2 px-4 border border-gray-300 rounded-md hover:bg-gray-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Pause
                                </button>
                                <button id="stopBtn" class="flex items-center justify-center py-2 px-4 border border-red-300 text-red-600 rounded-md hover:bg-red-50">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
                                    </svg>
                                    Stop
                                </button>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-200">
                                <div class="text-sm text-gray-600">
                                    <p class="mb-1"><strong>Connected as:</strong> ${this.state.selectedVoice?.name || 'AI Companion'}</p>
                                    <p><strong>Style:</strong> ${this.state.preferences.demeanor || 'Default'}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }
        };
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
